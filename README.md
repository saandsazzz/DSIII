# DSIII

## 人物属性对各面板能力的影响

黑魂3中通过消耗灵魂来升级人物，每一级可以选择提高一点属性值，这些属性值的提高会加强人物的面板能力，本章通过对升级后的面板能力变化进行分析（分析过程见分析文件夹），总结出各个属性对于各个面板能力的影响。

属性一共有九个：**生命力、集中力、持久力、体力、力气、敏捷、智力、信仰、运气**。

本章计算的面板能力包括：**防御力**（物理、防打击、防斩击、防突刺、魔力、火、雷、暗）**、抵抗力**（出血、毒、寒气、咒死）**、血量、专注值、精力、装备重量、寻宝能力、记忆空格**。

首先可以将各面板分为两类，一类面板能力会受到多个属性的影响，另一类面板能力只会受到单个属性影响。

### 多个属性影响

#### 防御力

防御力有两类，一类是物理：包括**物理防御力、防打击防御力、防斩击防御力、防突刺防御力**；

​                           一类是属性：包括**魔力、火、雷、暗**。

任何一个属性的增加都会造成所有的防御力增加，并且增加幅度基本一致

但是对于物理防御力，体力和力气两个属性有额外的增加幅度。

对于属性防御力，每一个都有一个对应的属性会有额外的增加幅度（不同属性防御力幅度一致）。

（魔力——智力，火——力气，雷——持久力，暗——信仰）

#### 抵抗力

抵抗力的成长类似与属性防御力。

首先任何一个属性的增加都会造成所有的防御力增加，并且增加幅度一致（与防御力的不一致）。

其次每一个抵抗力都有一个对应的属性会有额外的增加幅度（属性值30以后才会有，不同抵抗力幅度一致）。

（出血——持久力，毒——体力，寒气——生命力，咒死——运气）

#### 总结计算公式

根据防御力和抵抗力的增长特点，可以将各面板能力与属性值的关系通过一个通式和函数表来表示。

![1](https://latex.codecogs.com/svg.latex?y_j=\sum_{1}^{9}f_{ij}(x_{i}))

式中x<sub>i</sub>表示各属性值，y<sub>j</sub>表示各面板能力，具体如下表所示，f<sub>ij</sub>根据下表对应查得。

<h3 align = "center">防御力与抵抗力计算函数表</h3>

| <span style="display:inline-block;width:100px"> </span> | <span style="display:inline-block;width:100px">物理(y<sub>1</sub>)</span> | <span style="display:inline-block;width:100px">防打击(y<sub>2</sub>)</span> | <span style="display:inline-block;width:100px">防斩击(y<sub>3</sub>)</span> | <span style="display:inline-block;width:100px">防突刺(y<sub>4</sub>)</span> | <span style="display:inline-block;width:100px">魔力(y<sub>5</sub>)</span> | <span style="display:inline-block;width:100px">火(y<sub>6</sub>)</span> | <span style="display:inline-block;width:100px">雷(y<sub>7</sub>)</span> | <span style="display:inline-block;width:100px">暗(y<sub>8</sub>)</span> | <span style="display:inline-block;width:100px">出血(y<sub>9</sub>)</span> | <span style="display:inline-block;width:100px">毒(y<sub>10</sub>)</span> | <span style="display:inline-block;width:100px">寒气(y<sub>11</sub>)</span> | <span style="display:inline-block;width:100px">咒死(y<sub>12</sub>)</span> |
| :------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 生命力（x<sub>1</sub>）                                 | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function6                                                    | 0                                                            |
| 集中力（x<sub>2</sub>）                                 | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            |
| 持久力（x<sub>3</sub>）                                 | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function5                                                    | 0                                                            | function6                                                    | 0                                                            | 0                                                            | 0                                                            |
| 体力（x<sub>4</sub>）                                   | function3                                                    | function3                                                    | function3                                                    | function3                                                    | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function6                                                    | 0                                                            | 0                                                            |
| 力气（x<sub>5</sub>）                                   | function4                                                    | function4                                                    | function4                                                    | function4                                                    | 0                                                            | function5                                                    | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            |
| 敏捷（x<sub>6</sub>）                                   | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            |
| 智力（x<sub>7</sub>）                                   | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function5                                                    | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            |
| 信仰（x<sub>8</sub>）                                   | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function5                                                    | 0                                                            | 0                                                            | 0                                                            | 0                                                            |
| 运气（x<sub>9</sub>）                                   | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | 0                                                            | function6                                                    |
| 总和（x<sub>10</sub>）                                  | function1                                                    | function1                                                    | function1                                                    | function1                                                    | function1                                                    | function1                                                    | function1                                                    | function1                                                    | function2                                                    | function2                                                    | function2                                                    | function2                                                    |

#### 各函数公式

通过对各函数分离取整等操作，得到了每一个函数的通式。

这里的6个函数都是分段直线函数，并且在分析时总结出这里的各曲线都是通过确定一些整点然后连接得到的。

以下列出各函数的关键转折点以及其曲线图。

**function1：属性总和增加对防御力的影响**

关键点：（1，40），（150，100），（170，110），（240，120），（891，150）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function1_curve.png)



**function2：属性总和增加对抵抗力的影响**

关键点：（1，90），（150，120），（190，160），（240，175），（891，200）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function2_curve.png)



**function3：体力增加对防御力的额外影响**

关键点：（0，0），（15，5），（25，22），（40，40），（99，60）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function3_curve.png)



**function4：力气对防御力的额外影响**

关键点：（0，0），（30，10），（40，15），（60，30），（99，40）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function4_curve.png)



**function5：对应属性对属性防御力的额外影响**

关键点：（0，0），（30，20），（40，40），（60，70），（99，100）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function5_curve.png)



**function6：对应属性对抵抗力的额外影响**

关键点：（0，0），（30，0），（40，30），（60，40），（99，50）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/function6_curve.png)



### 单个属性影响

其余的**血量、专注值、精力、装备重量、寻宝能力、记忆空格**都由单个属性值决定。

（血量——生命力，专注值——集中力，精力——持久力，装备重量——体力，寻宝能力——运气，记忆空格——集中力）

这里**装备重量和寻宝能力**都是**线性增加**，**记忆空格**随着集中力的增加**阶梯式增长**。

而血量、专注值和精力的变化比较复杂，不再是前面的分段直线，部分段为曲线。

曲线应当都是对几个固定点进行插值补充，类似与Hermit插值的方法进行补充，而且插值的方法能够保证函数在插值段是单增函数

由于小数取整等影响，而且部分点的数据完全不符合多项式函数的，难以反推出符合所有值的通式。（计算器中直接存入了99个对应的值）

#### 血量

提高生命力会增加血量，增幅在15、16点生命力时达到最高，15点到27点之间增长幅度依旧可观，27点到50点增长幅度明显减少，50点之后达到最小。

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/HP_curve.png)

#### 专注值

提高集中力会增加专注值，增幅在35点集中力前都是在一直增加，35点之后到99增幅明显减少。

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/FP_curve.png)

#### 精力

提高持久力会增加精力，增幅在40点持久力之前都很可观，40以后到99增幅明显减少。

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/Stamina_curve.png)

#### 装备重量

提高体力会增加装备重量，整体呈线性。

起点：（0，40）	终点：（99，139）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/EquipmentLoad_curve.png)

#### 寻宝能力

提高运气会增加寻宝能力，整体呈线性。

起点：（0，100）	终点：（99，199）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/ItemDiscovery_curve.png)

#### 记忆空格

提高集中力会增加记忆空格的数量，在固定阶梯处记忆空格增加，最多为10个。

增长节点：（10，14，18，24，30，40，50，60，80，99）

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/AttunementSlots_curve.png)



### 升级需要灵魂数

升级会提升人物面板能力，同时也需要消耗游戏内货币——灵魂来进行升级。

等级越高，升级需要的灵魂数随之增加，这里升级消耗的灵魂数与等级之间的关系为多项式函数关系

分为两段，10级以前与11级以后，10级以前直接二次函数拟合即可满足所有点。

11级以后用4次函数拟合后基本所有点都落在拟合的4次函数上，函数通式为：

![2](http://latex.codecogs.com/gif.latex?\begin{cases}0.12*level^2+16*level+657.4\\\\-1e^{-12}*level^4+0.02*level^3+3.12*level^2+111.78*level-786.2\\\\\end{cases})

等级:1~10

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/SoulsToNextLevel_curve_1To10.png)

等级:11~802

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/SoulsToNextLevel_curve_11To802.png)

### 人物属性计算器

整理所有公式，使用Python中Pyqt5制作了一个简易的人物属性计算器，对不同出身下人物升级后的面板以及所消耗的灵魂数进行计算。

计算器打包在**人物计算器.exe**中，py代码在文件夹中。

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/人物计算器截图.png)

## 人物以及武器对面板攻击力的影响

游戏内打开人物面板可以看到攻击力有**物理、魔力、火、雷、暗**五种，

各类面板攻击力均两部分组成，白字基础攻击力+人物属性补正（白字为0时不显示补正）。

下面分别就这两部分进行分析，确定它们分别由什么计算而来。

（武器数据使用**UXM，Yabber，Yapper**等解包工具获得）

### 白字基础攻击力

不难发现，白字攻击力与人物属性没有任何关系，**完全由武器属性决定**。

对于一个确定的武器来说，它的属性有：**强化等级**、**质变类型**。

两者都会改变武器的白字攻击力，特别是质变，有时会让某类攻击力从0到某个值，像火焰质变阔剑后会让原本没有火属性攻击力的阔剑附加火属性攻击力。

而强化等级的提升基本上只会提高已有的各类攻击力的数值。

具体的计算公式为：		**AttackBase*AtkRate**

#### AttakBase

通过解包游戏数据，可以看到每种武器的每种质变都有着很多的成员参数，其中有五项为**AttackBasePhysics、AttackBaseMagic、AttackBaseFire、AttackBaseThunder、AttackBaseDark**，对应着武器的各类攻击力基础值。

像前面提到的阔剑，在无火焰质变前缀时，这里的数值为117，0，0，0，0

而火焰阔剑对应的数值为115，0，115，0，0

那么对于一个确定的武器以及确定的质变（或未质变），就能得到五项攻击力的**AttackBase**值。

#### AtkRate

除了上述的五项**AttackBase**，每把武器的每种质变（以下统称为各类武器）还有一些其他的参数，这里需要用到的就是**ReinforceTypeId**项

这里的各类武器的**ReinforceTypeId**都可以在另一个表格中作为索引找到5个**AtkRate**的值。

像阔剑查得**ReinforceTypeId**为0，火焰阔剑查得**ReinforceTypeId**为600.

除了各类武器对应的Id以外，表中还有Id+1到Id+10（或+5）的索引，分别对应的武器的各类强化等级（部分武器只能强化+5）

那么对于一个确定的武器、确定的质变、确定的强化等级就可以查询并计算出其**ReinforceTypeId**，然后得到五项攻击力的**AtkRate**值。

### 补正攻击力

影响补正攻击力的因素比较多。

首先补正攻击力是由**白字基础攻击力*补正系数**得到，白字基础攻击力低的，往往补正攻击力也不会太高。

而这里补正系数由武器属性和人物属性共同决定，体现为公式即为：

**补正系数=Σ武器补正系数*属性补正系数**

#### 武器补正系数

在黑魂的武器面板中，可以看到各个武器都有着**力量、敏捷、智力、信仰、运气**五个人物属性对应的补正等级S-D

这里的每个等级对应的是武器补正系数的一个范围，并不是确切值。而且在武器**升级或质变**后这些补正系数都会发生变化。

同样像阔剑的各属性补正为C、D、-、-、-（-表示该属性的补正系数）

质变到火焰后各属性补正为-、-、-、-、-，发现质变后获得了高面板的物理攻击力与火属性攻击力白字攻击力，同时失去了属性补正的，属于前期武器。

像巨剑初始的各属性补正为D、D、-、-、-

强化+10后增强到C、D、-、-、-

所以不管是质变还是强化都会影响到武器的补正系数，**这里武器补正系数只有5个，计算各类攻击力时使用的武器补正系数都是一样的。**

具体查表计算如下：

各类武器的参数中有**CorrectStrength、CorrectAbility、CorrectMagic、CorrectFaith、CorrectLuck**五项，

再根据上文中提到的**ReinforceTypeId**,类似与基础白字攻击力的计算，可以找到各强化等级对应的**CorrectStrengthRate，CorrectAbilityRate，等等**

两两相乘即可得到武器最终的各属性补正系数。

（基本上和白字攻击力的计算方法一致）

#### 人物属性补正系数

人物的各种属性会很大程度的影响补正攻击力的数值，像力量补正系数高的一些武器，力量堆上去后补正攻击力就十分可观。

这是因为对于各类武器的各个攻击力类型都有一个属性成长函数，属性从1-99，属性补正系数从0-1.

通过查询各类武器的PhysicsStatFunc、MagicStatFunc、FireStatFunc、ThunderStatFunc、DarkStatFunc项可以得到这五个函数的Id，

查到对应函数后，分别代入各人物属性值，则可以得到25个人物属性补正系数。

#### 计算各类攻击力补正值

前面得到了5项武器补正系数（对各类攻击力来说武器补正系数不变）以及25项人物属性补正系数，好像接下来根据**补正系数=Σ武器补正系数*属性补正系数**

就可以得到5个攻击力类型的最终补正系数了，但是计算出实际其实并没有这么高。

这是因为对于一个攻击力类型来说，并不是所有的属性补正系数都参与补正。

像一般来说，物理攻击力只受力量和敏捷补正，增加其他属性值并不会提高物理攻击力的补正值。

（魔力攻击力只受智力补正，火攻击力只受智力、信仰补正，雷攻击力只受信仰补正，暗攻击力只受智力、信仰补正）

但是像祝福质变后，物理攻击力还会受到信仰补正。

这些变化实际是通过一个对应表来控制的，通过各类武器的**AecpId**，查到其索引的对应表，有各种属性补正对各类攻击力是否有效的真值表。

那么至此得到了所有的信息。

在计算一个攻击力的补正系数时，首先确定对其有影响的属性，然后对这些属性计算      **武器补正系数*属性补正系数**     并求和。

再以该类攻击力的白字基础攻击力乘以补正系数，即可得到最终的补正攻击力。

### 武器攻击力计算表

最后将所有的提取数据归纳在表格中，填入相关计算公式。

通过Main表中的选择武器、质变、强化、各人物属性，可以计算出当前的武器各面板攻击力。

![Alt text](https://github.com/saandsazzz/DSIII/blob/main/image/武器计算表截图.png)
